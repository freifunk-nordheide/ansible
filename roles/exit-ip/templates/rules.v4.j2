# {{ ansible_managed }}
*nat
:PREROUTING ACCEPT [1:136]
:INPUT ACCEPT [1:136]
:OUTPUT ACCEPT [2:472]
:POSTROUTING ACCEPT [0:0]
-A POSTROUTING -o ens18 -j MASQUERADE
# COMMIT
# *filter
# :INPUT ACCEPT [1124:131621]
# -A INPUT -p udp -m multiport -i br-{{ site_code }} --destination-ports {{ fastd_port }}:{{ fastd_port + (fastd_instances-1) }} -j LOG --log-prefix "vpn-int-loop-" -m limit --limit 5/min
# -A INPUT -p udp -m multiport -i br-{{ site_code }} --destination-ports {{ fastd_port }}:{{ fastd_port + (fastd_instances-1) }} -j REJECT
# :FORWARD ACCEPT [0:0]
# -A FORWARD -p tcp -m tcp --tcp-flags SYN,RST SYN -j TCPMSS --clamp-mss-to-pmtu
# :OUTPUT ACCEPT [1151:175226]
# COMMIT
# #######################NEUNEUNEUNEU#########################
# Generated by iptables-save v1.4.21 on Thu May 30 15:57:26 2019
# *nat
# :PREROUTING ACCEPT [3:104]
# :INPUT ACCEPT [0:0]
# :OUTPUT ACCEPT [0:0]
# :POSTROUTING ACCEPT [0:0]
# -A POSTROUTING -o ens18 -j MASQUERADE
# -A POSTROUTING -o tun-anonvpn -j MASQUERADE
COMMIT
# Completed on Thu May 30 15:57:26 2019
# Generated by iptables-save v1.4.21 on Thu May 30 15:57:26 2019
*mangle
:PREROUTING ACCEPT [11370:7813495]
:INPUT ACCEPT [6233:2388227]
:FORWARD ACCEPT [5122:5424684]
:OUTPUT ACCEPT [22084:9311877]
:POSTROUTING ACCEPT [27188:14732143]
COMMIT
# Completed on Thu May 30 15:57:26 2019
# Generated by iptables-save v1.4.21 on Thu May 30 15:57:26 2019
*filter
:INPUT ACCEPT [0:0]
-A INPUT -p udp -m multiport -i br-{{ site_code }} --destination-ports {{ fastd_port }}:{{ fastd_port + (fastd_instances-1) }} -j LOG --log-prefix "vpn-int-loop-" -m limit --limit 5/min
-A INPUT -p udp -m multiport -i br-{{ site_code }} --destination-ports {{ fastd_port }}:{{ fastd_port + (fastd_instances-1) }} -j REJECT
:FORWARD ACCEPT [0:0]
:OUTPUT ACCEPT [2426:792761]
:DROP-log - [0:0]
:bat-forward - [0:0]
:bat-input - [0:0]
:forward - [0:0]
:input - [0:0]
:mesh-forward - [0:0]
:mesh-input - [0:0]
:wan-forward - [0:0]
:wan-input - [0:0]
-A INPUT -i lo -j ACCEPT
-A INPUT -p icmp -j ACCEPT
-A INPUT -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT
-A INPUT -m conntrack --ctstate INVALID -j DROP
-A INPUT -p udp -m conntrack --ctstate NEW -j input
-A INPUT -p udp -j REJECT --reject-with icmp-port-unreachable
-A INPUT -p tcp -m tcp --tcp-flags FIN,SYN,RST,ACK SYN -m conntrack --ctstate NEW -j input
-A INPUT -p tcp -j REJECT --reject-with tcp-reset
-A INPUT -j DROP
-A FORWARD -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT
-A FORWARD -m conntrack --ctstate INVALID -j DROP
-A FORWARD -p icmp -j ACCEPT
-A FORWARD -p udp -m conntrack --ctstate NEW -j forward
-A FORWARD -p udp -j REJECT --reject-with icmp-port-unreachable
-A FORWARD -p tcp -m tcp --tcp-flags FIN,SYN,RST,ACK SYN -m conntrack --ctstate NEW -j forward
-A FORWARD -p tcp -j REJECT --reject-with tcp-reset
-A FORWARD -j DROP
-A DROP-log ! -p tcp -j LOG --log-ip-options --log-uid
-A DROP-log -p tcp -j LOG --log-tcp-sequence --log-tcp-options --log-ip-options --log-uid
-A DROP-log -j DROP
-A bat-forward -j DROP
-A bat-input -p udp -m udp --dport 1001 -m comment --comment respondd -j ACCEPT
-A bat-input -p udp -m udp --dport 1001 -m comment --comment respondd -j ACCEPT
-A bat-input -p udp -m udp --dport 1001 -m comment --comment respondd -j ACCEPT
-A bat-input -j DROP
-A forward -i bat-{{ site_code }} -j bat-forward
-A forward -i br-{{ site_code }} -j mesh-forward
-A forward -i ens18 -j wan-forward
-A forward -i icvpn -j mesh-forward
-A forward -j DROP
-A input -i bat-{{ site_code }} -j bat-input
-A input -i br-{{ site_code }} -j mesh-input
-A input -i ens18 -j wan-input
-A input -i icvpn -j mesh-input
-A input -j DROP
-A mesh-forward -o br-{{ site_code }} -j ACCEPT
-A mesh-forward -o ens18 -j ACCEPT
-A mesh-forward -o icvpn -j ACCEPT
-A mesh-forward -o tun-anonvpn -j ACCEPT
-A mesh-forward -j DROP
-A mesh-input -p tcp -m tcp --dport 179 -m comment --comment bird -j ACCEPT
-A mesh-input -p udp -m udp --dport 67 -m comment --comment dhcpd -j ACCEPT
-A mesh-input -p udp -m udp --dport 68 -m comment --comment dhcpd -j ACCEPT
-A mesh-input -p tcp -m tcp --dport 80 -j ACCEPT
-A mesh-input -p udp -m udp --dport 1001 -m comment --comment respondd -j ACCEPT
-A mesh-input -p udp -m udp --dport 1001 -m comment --comment respondd -j ACCEPT
-A mesh-input -p udp -m udp --dport 1001 -m comment --comment respondd -j ACCEPT
-A mesh-input -p udp -m udp --dport 53 -m comment --comment named -j ACCEPT
-A mesh-input -p tcp -m tcp --dport 53 -m comment --comment named -j ACCEPT
-A mesh-input -p udp -m udp --dport 5300 -m comment --comment named -j ACCEPT
-A mesh-input -p tcp -m tcp --dport 5300 -m comment --comment named -j ACCEPT
-A mesh-input -p udp -m recent --update --seconds 3600 --hitcount 10 --name ntpd --mask 255.255.255.255 --rsource -m udp --dport 123 -j DROP
-A mesh-input -p udp -m recent --set --name ntpd --mask 255.255.255.255 --rsource -m udp --dport 123
-A mesh-input -p udp -m udp --dport 123 -m comment --comment ntpd -j ACCEPT
-A mesh-input -p tcp -m recent --update --seconds 60 --hitcount 3 --name sshd --mask 255.255.255.255 --rsource -m tcp --dport 22 -j DROP
-A mesh-input -p tcp -m recent --set --name sshd --mask 255.255.255.255 --rsource -m tcp --dport 22
-A mesh-input -p tcp -m tcp --dport 22 -j ACCEPT
-A mesh-input -p udp -m udp --dport 10010 -j ACCEPT
-A mesh-input -j DROP
-A wan-forward -j DROP
-A wan-input -s 127.0.0.0/8 -j DROP
-A wan-input -s 0.0.0.0/8 -j DROP
-A wan-input -s 240.0.0.0/4 -j DROP
-A wan-input -s 192.0.2.0/24 -j DROP
-A wan-input -s 198.51.100.0/24 -j DROP
-A wan-input -s 203.0.113.0/24 -j DROP
-A wan-input -s 192.168.0.0/16 -j DROP
-A wan-input -s 10.0.0.0/8 -j DROP
-A wan-input -s 172.16.0.0/12 -j DROP
-A wan-input -s 169.254.0.0/16 -j DROP
-A wan-input -p udp -m multiport -i br-{{ site_code }} --destination-ports {{ fastd_port }}:{{ fastd_port + (fastd_instances-1) }} -j ACCEPT 
-A wan-input -p tcp -m tcp --dport 80 -j ACCEPT
-A wan-input -p tcp -m recent --update --seconds 60 --hitcount 3 --name sshd --mask 255.255.255.255 --rsource -m tcp --dport 22 -j DROP
-A wan-input -p tcp -m recent --set --name sshd --mask 255.255.255.255 --rsource -m tcp --dport 22
-A wan-input -p tcp -m tcp --dport 22 -j ACCEPT
-A wan-input -p tcp -m tcp --dport 655 -m comment --comment tincd -j ACCEPT
-A wan-input -p udp -m udp --dport 10010 -j ACCEPT
-A wan-input -j DROP
COMMIT
# Completed on Thu May 30 15:57:26 2019
